import{d as e,k as a,l,D as t,A as s,ad as o,I as u,B as i,a6 as r,s as v,o as n,c,w as p,a as d,n as f,G as h,y as b,x as g,ag as m,i as y,L as x,u as T,_ as w}from"./index-f30f5313.js";import{i as N,j as z,C as _,K as $,L as k}from"./DemoPage.cf3c40e0.js";import{u as R}from"./use-id.cdfa0884.js";const C=w(e({__name:"z-sticky",props:{zIndex:{type:Number,default:99},offsetTop:{type:Number,default:0},disabled:{type:Boolean,default:!1},container:{type:null},scrollTop:{type:Number,default:0},h5NavHeight:{type:Number,default:44},customNavbar:Boolean},emits:["scroll"],setup(e,{expose:w,emit:C}){const[H,j]=N("sticky");z(H);const B=C,I=x(),O=R("z-sticky"),P=e,F=a(0),D=a(0),L=a(!1),V=a(0),A=a(0),E=a(0);let G,K;const q=a(!1);l((()=>P.offsetTop),(e=>{"number"==typeof e&&(P.scrollTop?U("scroll"):U("page"))})),l((()=>P.disabled),(e=>{e?(V.value=0,L.value=!1,W()):U("page")})),l((()=>P.container),(e=>{e&&F.value&&Y()})),l((()=>P.scrollTop),(()=>{U("scroll")}));const J=t((()=>{if(L.value&&!q.value)return{transform:V.value?"translate3d(0, "+V.value+"px, 0)":"",top:L.value?E.value+"px":"","z-index":P.zIndex,width:`${D.value}px`,height:`${F.value}px`}})),M=t((()=>{if(!q.value)return L.value?{width:`${D.value}px`,height:`${F.value}px`}:void 0})),Q=e=>new Promise(((a,l)=>{T().in(I).select(e).boundingClientRect((t=>{t?a(t):l(new Error(`can not find selector: ${e}`))})).exec()})),S=a(0),U=e=>{P.customNavbar?"web"==s().uniPlatform?E.value=P.offsetTop+S.value:E.value=P.offsetTop+S.value+s().statusBarHeight:"web"==s().uniPlatform?E.value=P.offsetTop+P.h5NavHeight:E.value=P.offsetTop,W(),_((()=>{Q(".z-sticky").then((a=>{F.value=a.height,D.value=a.width,V.value=0,"page"==e?(X(),Y()):P.offsetTop>=a.top?(B("scroll",{scrollTop:P.scrollTop,isFixed:!0}),L.value=!0,V.value=0):(B("scroll",{scrollTop:P.scrollTop,isFixed:!1}),L.value=!1)}))}))},W=(e=null)=>{e?"contentObserver"==e&&G&&G.disconnect():G&&G.disconnect()},X=()=>{W("contentObserver");let e=m(I,{thresholds:[1],initialRatio:1});e.relativeToViewport({top:-E.value}),e.observe(`#${O}`,(e=>{P.disabled||Z(e.boundingClientRect.top)})),G=e},Y=()=>{let e=P.container;e&&(W("containerObserver"),o((()=>{Q(".z-sticky").then((a=>{let l=a.top,t=e.top,s=e.height,o=l-t,u=m(I,{thresholds:[1],initialRatio:1});u.relativeToViewport({top:s-F.value-E.value-o}),u.observe(`#${O}`,(e=>{P.disabled||(E.value+a.height>s+e.boundingClientRect.top?V.value=s-a.height:(E.value,V.value=0),Z(e.boundingClientRect.top))})),K=o,A.value=s}))})))},Z=(e=0)=>{let a=K,l=A.value&&F.value?e>=F.value+E.value+a-A.value&&e<E.value:e<=E.value;l&&(V.value=0),B("scroll",{scrollTop:e,isFixed:l}),L.value=l};return l([$,k],(()=>{L.value&&(q.value=!0,o((()=>{Q(".z-sticky").then((e=>{const a=e;D.value=a.width,F.value=a.height,q.value=!1}))})))})),u((()=>{P.customNavbar?i("zNavbarHeight",(e=>{S.value=e,P.disabled||U("page")})):P.disabled||U("page")})),r((()=>{W(),v("zNavbarHeight")})),w({initObserver:U}),(e,a)=>{const l=y;return n(),c(l,{style:b(M.value)},{default:p((()=>[d(l,{class:f(h(j)()),style:b(M.value),id:h(O)},{default:p((()=>[d(l,{class:f([h(j)("wrap",{fixed:L.value})]),style:b(J.value)},{default:p((()=>[g(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])])),_:3},8,["class","style","id"])])),_:3},8,["style"])}}}),[["__scopeId","data-v-3ab6911f"]]);export{C as _};
