import{d as s,k as a,a5 as t,D as e,A as l,I as o,B as n,am as i,a9 as u,s as c,l as d,o as r,c as g,w as h,a as m,n as p,G as f,y as v,e as y,F as x,x as T,p as $,b as k,t as D,L as H,ad as _,i as z,_ as S}from"./index-f30f5313.js";import{m as b,n as j,i as V,j as w,y as B,c as P,C as I,x as M}from"./DemoPage.cf3c40e0.js";import{u as Y}from"./use-touch.6469fcb8.js";const A=S(s({name:"ZPullRefresh",options:{virtualHost:!0},props:{disabled:Boolean,modelValue:Boolean,headHeight:b(60),successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:j,successDuration:b(500),animationDuration:b(300),customStyle:Object,id:String},emits:["change","refresh","update:modelValue","init"],setup(s,{emit:S}){const[b,j]=V("pull-refresh");w(b);const A=H(),C=["pulling","loosing","success"],F=s,G=S;let L,O=0;const R=a(0),Z=t({status:"normal",distance:0,duration:0}),q=Y(),E=()=>{if(60!==F.headHeight)return{height:`${F.headHeight}px`}},J=e((()=>({...F.customStyle}))),K=()=>"loading"!==Z.status&&"success"!==Z.status&&!F.disabled,N=(s,a)=>{const t=+(F.pullDistance||F.headHeight);Z.distance=s,Z.status=a?"loading":0===s?"normal":s<t?"pulling":"loosing",G("change",{status:Z.status,distance:s})},Q=()=>{const{status:s}=Z;return"normal"===s?"":F[`${s}Text`]||{pulling:"下拉即可刷新...",loosing:"释放即可刷新...",loading:"加载中"}[s]},U=s=>{L=0===O,L&&(Z.duration=0,q.start(s))},W=s=>{K()&&U(s)},X=s=>{if(K()){L||U(s);const{deltaY:a}=q;q.move(s),L&&a.value>=0&&q.isVertical()&&N((s=>{const a=+(F.pullDistance||F.headHeight);return s>a&&(s=s<2*a?a+(s-a)/2:1.5*a+(s-2*a)/4),Math.round(s)})(a.value))}},ss=()=>{L&&q.deltaY.value&&K()&&(Z.duration=+F.animationDuration,"loosing"===Z.status?(N(+F.headHeight,!0),G("update:modelValue",!0),_((()=>G("refresh")))):N(0))},as=e((()=>{let s={};return R.value&&(s["min-height"]=B(R.value)),{transitionDuration:`${Z.duration}ms`,transform:Z.distance?`translate3d(0,${Z.distance}px, 0)`:"",...s}})),{windowHeight:ts}=l(),es=()=>{I((()=>{M(A,".z-pull-refresh-rect").then((s=>{const a=Math.floor(ts-s.top);R.value=a}))}))},ls=s=>{O=s.scrollTop};return o((()=>{es(),n(`z-pull-refresh-${F.id}`,ls)})),i((()=>{es()})),u((()=>{c(`z-pull-refresh-${F.id}`)})),d((()=>F.modelValue),(s=>{Z.duration=+F.animationDuration,s?N(+F.headHeight,!0):A.slots.success||F.successText?(Z.status="success",setTimeout((()=>{N(0)}),+F.successDuration)):N(0,!1)})),(s,a)=>{const t=z;return r(),g(t,{class:p(["z-pull-refresh-rect",f(j)()]),style:v(J.value)},{default:h((()=>[m(t,{class:p(f(j)("track")),style:v(as.value),onTouchstartPassive:W,onTouchend:ss,onTouchmove:X,onTouchcancel:ss},{default:h((()=>[m(t,{class:p(f(j)("head")),style:v(E())},{default:h((()=>[f(A).slots[Z.status]?(r(),y(x,{key:0},[f(A).slots.normal&&"normal"==Z.status?T(s.$slots,"normal",{key:0,distance:Z.distance},void 0,!0):$("",!0),f(A).slots.loading&&"loading"==Z.status?T(s.$slots,"loading",{key:1,distance:Z.distance},void 0,!0):$("",!0),f(A).slots.loosing&&"loosing"==Z.status?T(s.$slots,"loosing",{key:2,distance:Z.distance},void 0,!0):$("",!0),f(A).slots.pulling&&"pulling"==Z.status?T(s.$slots,"pulling",{key:3,distance:Z.distance},void 0,!0):$("",!0),f(A).slots.success&&"success"==Z.status?T(s.$slots,"success",{key:4,distance:Z.distance},void 0,!0):$("",!0)],64)):(r(),y(x,{key:1},[C.includes(Z.status)?(r(),g(t,{key:0,class:p(f(j)("text"))},{default:h((()=>[k(D(Q()),1)])),_:1},8,["class"])):$("",!0),"loading"===Z.status?(r(),g(P,{key:1,size:"var(--z-pull-refresh-loading-icon-size)"},{default:h((()=>[k(D(Q()),1)])),_:1})):$("",!0)],64))])),_:3},8,["class","style"]),T(s.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-c3aa1bfe"]]);export{A as _};
