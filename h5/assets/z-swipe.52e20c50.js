import{d as e,a5 as t,D as a,I as s,ad as i,o as l,e as o,x as u,y as c,_ as n,l as r,a1 as v,a2 as h,a9 as p,c as d,w as f,a as g,n as w,G as m,F as y,r as x,i as S,L as C}from"./index-f30f5313.js";import{u as $}from"./useParent.17bb91a9.js";import{v as b,t as z,n as _,m as T,i as j,F as I,C as M,x as k,G as O}from"./DemoPage.cf3c40e0.js";import{u as D}from"./useChildren.47d4431b.js";import{u as P}from"./use-touch.6469fcb8.js";const X=n(e({name:"ZSwipeItem",options:{virtualHost:!0},props:{customStyle:Object},setup(e){const n=t({offset:0,inited:!1,mounted:!1}),r=e,{parent:v}=$("z-swipe"),h=a((()=>{const e={};if(v){const{vertical:t}=v.props;v.size.value&&(e[t?"height":"width"]=`${v.size.value}px`),n.offset&&(e.transform=`translate${t?"Y":"X"}(${n.offset}px)`)}return{...e,...r.customStyle}}));return s((()=>{i((()=>{n.mounted=!0}))})),b({setOffset:e=>{n.offset=e}}),(e,t)=>(l(),o("div",{class:"swipe-item",style:c([h.value])},[u(e.$slots,"default",{},void 0,!0)],4))}}),[["__scopeId","data-v-e6a740d6"]]),Y=n(e({name:"ZSwipe",options:{virtualHost:!0},props:{loop:z,width:_,height:_,vertical:Boolean,autoplay:T(0),duration:T(500),touchable:z,initialSwipe:T(0),indicatorColor:String,showIndicators:z,stopPropagation:z,customStyle:Object},emits:["change","dragStart","dragEnd"],setup(e,{expose:i,emit:n}){const $=n,[z,_]=j("swipe"),T=C(),X=e,Y=t({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let E=!1;const F=P(),{children:G,linkChildren:H}=D(z),Z=a((()=>G.length)),B=a((()=>Y[X.vertical?"height":"width"])),L=a((()=>X.vertical?F.deltaY.value:F.deltaX.value)),q=a((()=>{if(Y.rect){return(X.vertical?Y.rect.height:Y.rect.width)-B.value*Z.value}return 0})),A=a((()=>B.value?Math.ceil(Math.abs(q.value)/B.value):Z.value)),J=a((()=>Z.value*B.value)),K=a((()=>(Y.active+Z.value)%Z.value)),N=a((()=>{const e=X.vertical?"vertical":"horizontal";return F.direction.value===e})),Q=a((()=>{const e={transitionDuration:`${Y.swiping?0:X.duration}ms`,transform:`translate${X.vertical?"Y":"X"}(${+Y.offset.toFixed(2)}px)`};if(B.value){const t=X.vertical?"height":"width",a=X.vertical?"width":"height";e[t]=`${J.value}px`,e[a]=X[a]?`${X[a]}px`:""}return e})),R=(e,t=0)=>{let a=e*B.value;X.loop||(a=Math.min(a,-q.value));let s=t-a;return X.loop||(s=O(s,q.value,0)),s},U=({pace:e=0,offset:t=0,emitChange:a})=>{if(Z.value<=1)return;const{active:s}=Y,i=(e=>{const{active:t}=Y;return e?X.loop?O(t+e,-1,Z.value):O(t+e,0,A.value):t})(e),l=R(i,t);if(X.loop){if(G[0]&&l!==q.value){const e=l<q.value;G[0].setOffset(e?J.value:0)}if(G[Z.value-1]&&0!==l){const e=l>0;G[Z.value-1].setOffset(e?-J.value:0)}}Y.active=i,Y.offset=l,a&&i!==s&&$("change",K.value)},V=()=>{Y.swiping=!0,Y.active<=-1?U({pace:Z.value}):Y.active>=Z.value&&U({pace:-Z.value})},W=()=>{V(),F.reset(),I((()=>{Y.swiping=!1,U({pace:-1,emitChange:!0})}))},ee=()=>{V(),F.reset(),I((()=>{Y.swiping=!1,U({pace:1,emitChange:!0})}))};let te;const ae=()=>clearTimeout(te),se=()=>{ae(),+X.autoplay>0&&Z.value>1&&(te=setTimeout((()=>{ee(),se()}),+X.autoplay))},ie=(e=+X.initialSwipe)=>{M((()=>{k(T,".z-swipe-rect").then((t=>{const a=t;(()=>{const t={width:a.width,height:a.height};Y.rect=t,Y.width=+(X.width?X.width:t.width),Y.height=+(X.height?X.height:t.height),Z.value&&-1===(e=Math.min(Z.value-1,e))&&(e=Z.value-1),Y.active=e,Y.swiping=!0,Y.offset=R(e),G.forEach((e=>{e.setOffset(0)})),se()})()}))}))},le=()=>ie(Y.active);let oe;const ue=e=>{!X.touchable||e.touches.length>1||(F.start(e),E=!1,oe=Date.now(),ae(),V())},ce=e=>{if(X.touchable&&Y.swiping&&(F.move(e),N.value)){!X.loop&&(0===Y.active&&L.value>0||Y.active===Z.value-1&&L.value<0)||(U({offset:L.value}),E||($("dragStart",{index:K.value}),E=!0))}},ne=()=>{if(!X.touchable||!Y.swiping)return;const e=Date.now()-oe,t=L.value/e;if((Math.abs(t)>.25||Math.abs(L.value)>B.value/2)&&N.value){const e=X.vertical?F.offsetY.value:F.offsetX.value;let t=0;t=X.loop?e>0?L.value>0?-1:1:0:-Math[L.value>0?"ceil":"floor"](L.value/B.value),U({pace:t,emitChange:!0})}else L.value&&U({pace:0});E=!1,Y.swiping=!1,$("dragEnd",{index:K.value}),se()},re=(e,t={})=>{V(),F.reset(),I((()=>{let a;a=X.loop&&e===Z.value?0===Y.active?0:e:e%Z.value,t.immediate?I((()=>{Y.swiping=!1})):Y.swiping=!1,U({pace:a-Y.active,emitChange:!0})}))};return b({prev:W,next:ee,state:Y,resize:le,swipeTo:re}),H({size:B,props:X,count:Z,activeIndicator:K}),i({prev:W,next:ee,state:Y,resize:le,swipeTo:re}),r((()=>X.initialSwipe),(e=>ie(+e))),r(Z,(()=>ie(Y.active))),r((()=>X.autoplay),se),r([()=>X.width,()=>X.height],le),s(ie),v((()=>ie(Y.active))),h(ae),p(ae),(t,a)=>{const s=S;return l(),d(s,{class:w(["z-swipe-rect",[m(_)()]]),style:c(e.customStyle)},{default:f((()=>[g(s,{style:c(Q.value),class:w(m(_)("track",{vertical:X.vertical})),onTouchstartPassive:ue,onTouchmovePassive:ce,onTouchend:ne,onTouchcancel:ne},{default:f((()=>[u(t.$slots,"default",{},void 0,!0)])),_:3},8,["style","class"]),e.showIndicators&&Z.value>1?(l(),d(s,{key:0,class:w(m(_)("indicators",{vertical:X.vertical}))},{default:f((()=>[(l(!0),o(y,null,x(Z.value,((e,t)=>(l(),d(s,{key:t,style:c({backgroundColor:t===K.value?X.indicatorColor:""}),class:w(m(_)("indicator",{active:t===K.value}))},null,8,["style","class"])))),128))])),_:1},8,["class"])):u(t.$slots,"indicator",{key:1,active:K.value,total:Z.value},void 0,!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-494aee60"]]);export{X as _,Y as a};
