import{d as e,k as l,a5 as t,D as a,l as o,I as s,o as r,c as i,w as n,n as c,G as u,y as d,a3 as p,i as g,a as f,K as m,x as y,p as h,e as b,F as v,b as k,t as w,L as x,ah as S,J as z,C as I,_ as C}from"./index-f30f5313.js";import{u as A}from"./useParent.17bb91a9.js";import{C as _}from"./index.3b818c1b.js";import{N as B,O as V,s as M,m as $,n as j,t as T,E as W,k as P,i as E,j as L,P as q,I as F,v as D,z as O,y as R,Q as N,R as G}from"./DemoPage.cf3c40e0.js";import{u as H}from"./use-id.cdfa0884.js";import{_ as J}from"./z-cell.b545d216.js";function K(e){return Array.isArray(e)?!e.length:0!==e&&!e}function Q(e,l){const{message:t}=l;return V(t)?t(e,l):t||""}function Z({target:e}){e.composing=!0}function U({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function X(e){return[...e].length}function Y(e,l){return[...e].slice(0,l).join("")}const ee={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:{type:Number,default:140},formatter:Function,clearIcon:M("close-circle-fill"),modelValue:$(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:M("focus"),formatTrigger:M("onInput"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},le=C(e({name:"ZField",options:{virtualHost:!0},props:P({},{icon:String,size:String,title:j,value:j,label:j,center:Boolean,isLink:Boolean,border:T,iconPrefix:String,valueClass:W,labelClass:W,titleClass:W,titleStyle:null,arrowDirection:String,required:{type:[Boolean,String],default:null},clickable:{type:Boolean,default:null}},ee,{rows:j,type:M("text"),confirmType:M("done"),rules:Array,autosize:[Boolean,Object],labelWidth:j,labelClass:W,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null},placeholderStyle:String,leftIconColor:String,cellStyle:Object,customStyle:Object}),emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue","click","confirm"],setup(e,{emit:C}){const[V,M]=E("field");L(V);const $=x(),j=e,T=l(""),W=C,P=H(),ee=t({status:"unvalidated",focused:!1,validateMessage:""}),le=l(),{parent:te}=A(N),ae=a((()=>ze.value?"color: var(--z-field-input-error-text-color);"+j.placeholderStyle:"color: var(--z-field-placeholder-text-color);"+j.placeholderStyle)),oe=()=>String(j.modelValue?j.modelValue:""),se=e=>F(j[e])?j[e]:te&&F(te.props[e])?te.props[e]:void 0,re=a((()=>{const e=se("readonly");if(j.clearable&&!e){const e=""!==oe(),l="always"===j.clearTrigger||"focus"===j.clearTrigger&&ee.focused;return e&&l}return!1})),ie=a((()=>le.value&&$.slots.input?le.value():j.modelValue)),ne=a((()=>{var e;const l=se("required");return"auto"===l?null==(e=j.rules)?void 0:e.some((e=>e.required)):l})),ce=a((()=>({"flex-wrap":"wrap",...j.cellStyle}))),ue=e=>e.reduce(((e,l)=>e.then((()=>{if("failed"===ee.status)return;let{value:e}=ie;if(l.formatter&&(e=l.formatter(e,l)),!function(e,l){if(K(e)){if(l.required)return!1;if(!1===l.validateEmpty)return!0}return!(l.pattern&&!l.pattern.test(String(e)))}(e,l))return ee.status="failed",void(ee.validateMessage=Q(e,l));if(l.validator){if(K(e)&&!1===l.validateEmpty)return;return function(e,l){return new Promise((t=>{const a=l.validator(e,l);B(a)?a.then(t):t(a)}))}(e,l).then((t=>{t&&"string"==typeof t?(ee.status="failed",ee.validateMessage=t):!1===t&&(ee.status="failed",ee.validateMessage=Q(e,l))}))}}))),Promise.resolve()),de=()=>{ee.status="unvalidated",ee.validateMessage=""},pe=()=>W("endValidate",{status:ee.status,message:ee.validateMessage}),ge=(e=j.rules)=>new Promise((l=>{de(),e?(W("startValidate"),ue(e).then((()=>{"failed"===ee.status?(l({name:j.name,message:ee.validateMessage}),pe()):(ee.status="passed",l(),pe())}))):l()})),fe=e=>{if(te&&j.rules){const{validateTrigger:l}=te.props,t=G(l).includes(e),a=j.rules.filter((l=>l.trigger?G(l.trigger).includes(e):t));a.length&&ge(a)}},me=(e,l="onInput")=>{if(e=(e=>{const{maxlength:l}=j;if(F(l)&&X(e)>+l){const t=oe();return t&&X(t)===+l?t:Y(e,+l)}return e})(e),"number"===j.type||"digit"===j.type){const l="number"===j.type;e=q(e,l,l)}if(j.formatter&&l===j.formatTrigger){const{formatter:l,maxlength:t}=j;e=l(e),F(t)&&X(e)>+t&&(e=Y(e,+t))}T.value=e,e!==j.modelValue&&W("update:modelValue",e)},ye=e=>{me(e.detail.value)},he=e=>{W("confirm",e)},be=e=>{ee.focused=!0,W("focus",e),se("readonly")},ve=e=>{ee.focused=!1,me(oe(),"onBlur"),W("blur",e),se("readonly")||fe("onBlur")},ke=e=>W("clickInput",e),we=e=>W("clickLeftIcon",e),xe=e=>W("clickRightIcon",e),Se=e=>{W("update:modelValue",""),W("clear",e)},ze=a((()=>"boolean"==typeof j.error?j.error:!(!te||!te.props.showError||"failed"!==ee.status)||void 0)),Ie=a((()=>{const e={flex:"none",boxSizing:"border-box",width:"var(--z-field-label-width)",marginRight:"var(--z-field-label-margin-right)",color:"var(--z-field-label-color)",textAlign:"left",wordWrap:"break-word"};let l={};l="left"==j.labelAlign?{}:"center"==j.labelAlign?{"text-align":"center"}:"right"==j.labelAlign?{"text-align":"right"}:"top"==j.labelAlign?{display:"flex",width:"100%",textAlign:"left",marginBottom:"var(--z-padding-base)",overflowWrap:"break-word"}:{};const t=se("labelWidth"),a=se("labelAlign");return t&&"top"!==a?{...e,...l,width:R(t)}:{...e,...l}})),Ce=()=>j.id||`${P}-input`,Ae=()=>{W("click")};D({blur:()=>{},focus:()=>{},validate:ge,formValue:ie,resetValidation:de,getValidationStatus:()=>ee.status}),p(_,{customValue:le,resetValidation:de,validateWithTrigger:fe}),o((()=>j.modelValue),(()=>{me(oe()),de(),fe("onInput")})),s((()=>{me(oe(),j.formatTrigger)}));const _e=a((()=>({display:"block","font-size":"var(--z-field-icon-size)","line-height":"inherit"}))),Be=a((()=>({display:"block","font-size":"var(--z-field-icon-size)","line-height":"inherit"}))),Ve=a((()=>({display:"block"})));return(e,l)=>{const t=g,a=S,o=z,s=I;return r(),i(t,{class:c(u(M)({error:ze.value,disabled:e.disabled,[`label-${e.labelAlign}`]:e.labelAlign})),style:d(e.customStyle)},{default:n((()=>[f(J,{"custom-style":ce.value,size:j.size,center:j.center,border:j.border,"is-link":j.isLink,clickable:j.clickable,"title-style":Ie.value,"value-style":{overflow:"visible"},"title-class":[u(M)("label",[e.labelAlign]),j.labelClass],"arrow-direction":j.arrowDirection,onClick:Ae},m({title:n((()=>["top"===e.labelAlign?(r(),b(v,{key:0},[j.leftIcon||u($).slots["left-icon"]?(r(),i(t,{key:0,class:c(u(M)("left-icon")),onClick:we},{default:n((()=>[u($).slots["left-icon"]?y(e.$slots,"left-icon",{key:0},void 0,!0):h("",!0),f(O,{name:j.leftIcon,"class-prefix":j.iconPrefix,"custom-style":_e.value,"badge-wrapper-style":Ve.value},null,8,["name","class-prefix","custom-style","badge-wrapper-style"])])),_:3},8,["class"])):h("",!0),u($).slots.label?(r(),b(v,{key:1},[y(e.$slots,"label",{},void 0,!0),k(w(se("colon")?":":""),1)],64)):j.label?(r(),i(t,{key:2,id:`${u(P)}-label`,style:d("top"===se("labelAlign")&&se("labelWidth")?{width:u(R)(se("labelWidth"))}:void 0)},{default:n((()=>[k(w(j.label+(se("colon")?":":"")),1)])),_:1},8,["id","style"])):h("",!0)],64)):(r(),b(v,{key:1},[u($).slots.label?(r(),b(v,{key:0},[y(e.$slots,"label",{},void 0,!0),k(w(se("colon")?":":""),1)],64)):j.label?(r(),i(t,{key:1,id:`${u(P)}-label`,class:c(u(M)("label--content",{required:ne.value})),style:d("top"===se("labelAlign")&&se("labelWidth")?{width:u(R)(se("labelWidth"))}:void 0)},{default:n((()=>[k(w(j.label+(se("colon")?":":"")),1)])),_:1},8,["id","class","style"])):h("",!0)],64))])),default:n((()=>[f(t,{class:c(u(M)("body"))},{default:n((()=>[u($).slots.input?(r(),i(t,{key:0,class:c(u(M)("control",[se("inputAlign"),{error:ze.value,custom:!!u($).slots.input,"min-height":"textarea"===j.type&&!j.autosize}])),onClick:ke},{default:n((()=>[y(e.$slots,"input",{},void 0,!0)])),_:3},8,["class"])):"textarea"===j.type?(r(),i(a,{key:1,id:Ce(),name:j.name,value:T.value,rows:void 0!==j.rows?+j.rows:void 0,maxlength:j.maxlength,"placeholder-style":ae.value,class:c(u(M)("control",[se("inputAlign"),{error:ze.value,custom:!!u($).slots.input,"min-height":"textarea"===j.type&&!j.autosize}])),"auto-height":!!j.autosize,disabled:se("disabled")||se("readonly"),readonly:se("readonly"),autofocus:j.autofocus,placeholder:j.placeholder,autocomplete:j.autocomplete,autocapitalize:j.autocapitalize,autocorrect:j.autocorrect,enterkeyhint:j.enterkeyhint,spellcheck:j.spellcheck,onBlur:ve,onFocus:be,onInput:ye,onClick:ke,onCompositionend:u(U),onCompositionstart:u(Z)},null,8,["id","name","value","rows","maxlength","placeholder-style","class","auto-height","disabled","readonly","autofocus","placeholder","autocomplete","autocapitalize","autocorrect","enterkeyhint","spellcheck","onCompositionend","onCompositionstart"])):(r(),i(o,{key:2,type:j.type,"confirm-type":j.confirmType,id:Ce(),name:j.name,value:T.value,rows:void 0!==j.rows?+j.rows:void 0,maxlength:j.maxlength,"placeholder-style":ae.value,style:d(se("readonly")?"pointer-events: none;":""),class:c(u(M)("control",[se("inputAlign"),{disabled:e.disabled,error:ze.value,custom:!!u($).slots.input,"min-height":"textarea"===j.type&&!j.autosize}])),disabled:se("disabled")||se("readonly"),readonly:se("readonly"),autofocus:j.autofocus,placeholder:j.placeholder,autocomplete:j.autocomplete,autocapitalize:j.autocapitalize,autocorrect:j.autocorrect,enterkeyhint:j.enterkeyhint,spellcheck:j.spellcheck,onBlur:ve,onFocus:be,onInput:ye,onConfirm:he,onClick:ke,onCompositionend:u(U),onCompositionstart:u(Z)},null,8,["type","confirm-type","id","name","value","rows","maxlength","placeholder-style","style","class","disabled","readonly","autofocus","placeholder","autocomplete","autocapitalize","autocorrect","enterkeyhint","spellcheck","onCompositionend","onCompositionstart"])),re.value?(r(),i(t,{key:3,class:c(u(M)("clear"))},{default:n((()=>[f(O,{name:j.clearIcon,"badge-wrapper-style":Ve.value,onTouchstart:Se},null,8,["name","badge-wrapper-style"])])),_:1},8,["class"])):h("",!0),j.rightIcon||u($).slots["right-icon"]?(r(),i(t,{key:4,class:c(u(M)("right-icon")),onClick:xe},{default:n((()=>[u($).slots["right-icon"]?y(e.$slots,"right-icon",{key:0},void 0,!0):(r(),i(O,{key:1,name:j.rightIcon,"class-prefix":j.iconPrefix,"badge-wrapper-style":Ve.value,"custom-style":Be.value},null,8,["name","class-prefix","badge-wrapper-style","custom-style"]))])),_:3},8,["class"])):h("",!0),u($).slots.button?(r(),i(t,{key:5,class:c(u(M)("button"))},{default:n((()=>[y(e.$slots,"button",{},void 0,!0)])),_:3},8,["class"])):h("",!0)])),_:3},8,["class"]),j.showWordLimit&&j.maxlength?(r(),i(t,{key:0,class:c(u(M)("word-limit"))},{default:n((()=>[f(s,{class:c(u(M)("word-num"))},{default:n((()=>[k(w(u(X)(oe())),1)])),_:1},8,["class"]),k("/"+w(j.maxlength),1)])),_:1},8,["class"])):h("",!0),u(te)&&!1!=!u(te).props.showErrorMessage?h("",!0):(r(),b(v,{key:1},[j.errorMessage||ee.validateMessage?(r(),i(t,{key:0,class:c(u(M)("error-message",se("errorMessageAlign")))},{default:n((()=>[u($).slots["error-message"]?y(e.$slots,"error-message",{key:0,message:j.errorMessage||ee.validateMessage},void 0,!0):(r(),b(v,{key:1},[k(w(j.errorMessage||ee.validateMessage),1)],64))])),_:3},8,["class"])):h("",!0)],64))])),extra:n((()=>[y(e.$slots,"extra",{},void 0,!0)])),_:2},[(j.leftIcon||u($).slots["left-icon"])&&"top"!==e.labelAlign?{name:"icon",fn:n((()=>[f(t,{class:c(u(M)("left-icon")),onClick:we},{default:n((()=>[u($).slots["left-icon"]?y(e.$slots,"left-icon",{key:0},void 0,!0):h("",!0),f(O,{name:j.leftIcon,"class-prefix":j.iconPrefix,color:j.leftIconColor,"custom-style":_e.value,"badge-wrapper-style":Ve.value},null,8,["name","class-prefix","color","custom-style","badge-wrapper-style"])])),_:3},8,["class"])])),key:"0"}:void 0]),1032,["custom-style","size","center","border","is-link","clickable","title-style","title-class","arrow-direction"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-a3d734eb"]]);export{le as _,ee as f};
