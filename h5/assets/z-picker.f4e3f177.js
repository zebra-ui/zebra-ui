import{d as o,D as t,o as e,c as n,w as l,x as a,e as s,F as i,b as c,t as u,p as r,n as p,G as m,i as d,_ as v,k as f,aa as h,a as k,y,r as b,l as g,K as x,z as S,L as T,ad as w}from"./index-f30f5313.js";import{i as $,G as B,I as _,k as z,j as I,a as O,n as H,S as C,l as j,v as D,m as N,t as P,s as V,c as M,U as E,o as F,p as Z}from"./DemoPage.cf3c40e0.js";import{u as A}from"./useParent.17bb91a9.js";import{u as G}from"./use-touch.6469fcb8.js";import{u as K}from"./useChildren.47d4431b.js";const[L,U,Y]=$("picker"),q=o=>o.find((o=>!o.disabled))||o[0];function J(o,t){for(let e=t=B(t,0,o.length);e<o.length;e++)if(!o[e].disabled)return e;for(let e=t-1;e>=0;e--)if(!o[e].disabled)return e;return 0}const Q=(o,t,e)=>void 0!==t&&!!o.find((o=>o[e.value]===t));function R(o,t,e){const n=o.findIndex((o=>o[e.value]===t));return o[J(o,n)]}const W=v(o({name:"ZPickerToolbar",options:{virtualHost:!0},props:{title:String,cancelButtonText:String,confirmButtonText:String,componentSlots:Object},emits:["confirm","cancel"],setup(o,{emit:v}){const[f]=$("picker-toolbar");I(f);const h=o,k=v,y=()=>k("cancel"),b=()=>k("confirm"),g=t((()=>({color:"var(--z-picker-cancel-action-color)",padding:"var(--z-picker-action-padding)",fontSize:"var(--z-picker-action-font-size)"}))),x=t((()=>({color:"var(--z-picker-confirm-action-color)",padding:"var(--z-picker-action-padding)",fontSize:"var(--z-picker-action-font-size)"})));return(t,v)=>{const f=d;return e(),n(f,{class:p(m(U)("toolbar"))},{default:l((()=>[o.componentSlots&&o.componentSlots.toolbar?a(t.$slots,"toolbar",{key:0},void 0,!0):(e(),s(i,{key:1},[o.componentSlots&&o.componentSlots.cancel||!h.cancelButtonText||h.cancelButtonText?(e(),n(O,{key:0,type:"text","custom-style":g.value,onClick:y},{default:l((()=>[o.componentSlots&&o.componentSlots.cancel?a(t.$slots,"cancel",{key:0},void 0,!0):(e(),s(i,{key:1},[c(u(h.cancelButtonText?h.cancelButtonText:"取消"),1)],64))])),_:3},8,["custom-style"])):r("",!0),o.componentSlots&&o.componentSlots.title?a(t.$slots,"title",{key:1},void 0,!0):r("",!0),h.title?(e(),n(f,{key:2,class:p([m(U)("title"),"z-ellipsis"])},{default:l((()=>[c(u(h.title),1)])),_:1},8,["class"])):r("",!0),o.componentSlots&&o.componentSlots.confirm||!h.confirmButtonText||h.confirmButtonText?(e(),n(O,{key:3,type:"text","custom-style":x.value,onClick:b},{default:l((()=>[o.componentSlots&&o.componentSlots.confirm?a(t.$slots,"confirm",{key:0},void 0,!0):(e(),s(i,{key:1},[c(u(h.confirmButtonText?h.confirmButtonText:"确认"),1)],64))])),_:3},8,["custom-style"])):r("",!0)],64))])),_:3},8,["class"])}}}),[["__scopeId","data-v-41f726cb"]]),X=v(o({name:"ZPickerColumn",options:{virtualHost:!0},props:{value:H,fields:C(Object),options:j(),readonly:Boolean,allowHtml:Boolean,optionHeight:C(Number),swipeDuration:C(H),visibleOptionNum:C(H),componentSlots:Object},emits:["change","clickOption","scrollInto"],setup(o,{emit:r}){const[v,g]=$("picker-column"),x=o,S=r;let T,w,_,z,I;const O=f(0),H=f(0),C=G(),j=()=>x.options.length,N=o=>{let t=J(x.options,o);const e=-t*x.optionHeight,n=()=>{t>j()-1&&(t=J(x.options,o));const e=x.options[t][x.fields.value];e!==x.value&&S("change",e)};T&&e!==O.value?I=n:n(),O.value=e},P=()=>x.readonly||!x.options.length,V=t((()=>({height:`${x.optionHeight}px`}))),M=o=>B(Math.round(-o/x.optionHeight),0,j()-1),E=t((()=>M(O.value))),F=()=>{T=!1,H.value=0,I&&(I(),I=null)},Z=o=>{P()||(C.start(o),H.value=0,w=O.value,_=Date.now(),z=w,I=null)},K=o=>{if(P())return;C.move(o),C.isVertical()&&(T=!0);const t=B(w+C.deltaY.value,-j()*x.optionHeight,x.optionHeight),e=M(t);e!==E.value&&S("scrollInto",x.options[e]),O.value=t;const n=Date.now();n-_>300&&(_=n,z=t)},L=()=>{if(P())return;const o=O.value-z,t=Date.now()-_;if(t<300&&Math.abs(o)>15)return void((o,t)=>{const e=Math.abs(o/t);o=O.value+e/.003*(o<0?-1:1);const n=M(o);H.value=+x.swipeDuration,N(n)})(o,t);const e=M(O.value);H.value=200,N(e),setTimeout((()=>{T=!1}),0)};return A(v),D({stopMomentum:F}),h((()=>{const o=T?Math.floor(-O.value/x.optionHeight):x.options.findIndex((o=>o[x.fields.value]===x.value)),t=J(x.options,o),e=-t*x.optionHeight;T&&t<o&&F(),O.value=e})),(o,t)=>{const r=d;return e(),n(r,{class:p(m(g)()),onTouchstartPassive:Z,onTouchmove:K,onTouchend:L,onTouchcancel:L},{default:l((()=>[k(r,{style:y({transform:`translate3d(0, ${O.value+x.optionHeight*(+x.visibleOptionNum-1)/2}px, 0)`,transitionDuration:`${H.value}ms`,transitionProperty:H.value?"all":"none"}),class:p(m(g)("wrapper")),onTransitionend:F},{default:l((()=>[(e(!0),s(i,null,b(x.options,((t,s)=>(e(),n(r,{key:s,role:"button",style:y(V.value),tabindex:t.disabled?-1:0,class:p([m(g)("item",{disabled:t.disabled,selected:t[x.fields.value]===x.value}),t.className]),onClick:()=>(o=>{T||P()||(I=null,H.value=200,N(o),S("clickOption",x.options[o]))})(s)},{default:l((()=>[x.componentSlots&&x.componentSlots.option?a(o.$slots,"option",{key:0},void 0,!0):(e(),n(r,{key:1,class:"z-ellipsis"},{default:l((()=>[c(u(t[x.fields.text]),1)])),_:2},1024))])),_:2},1032,["style","tabindex","class","onClick"])))),128))])),_:3},8,["style","class"])])),_:3},8,["class"])}}}),[["__scopeId","data-v-a99a2f31"]]),oo=v(o({name:"ZPicker",options:{virtualHost:!0},props:{loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:N(44),showToolbar:P,swipeDuration:N(1e3),visibleOptionNum:N(6),title:String,cancelButtonText:String,confirmButtonText:String,columns:j(),modelValue:j(),toolbarPosition:V("top"),columnsFieldNames:Object,componentSlots:Object},emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(o,{emit:c}){const u=T(),v=o,h=c,$=f(v.modelValue.slice(0)),{parent:B}=A("z-picker-group"),{children:I,linkChildren:O}=K("z-picker-column"),H=t((()=>F(v.componentSlots))),C=o=>H.value?!(!v.componentSlots||!v.componentSlots[o])&&v.componentSlots[o]:u.slots[o];O();const j=t((()=>function(o){return z({text:"text",value:"value",children:"children"},o)}(v.columnsFieldNames))),N=t((()=>Number(v.optionHeight))),P=t((()=>function(o,t){const e=o[0];if(e){if(Array.isArray(e))return"multiple";if(t.children in e)return"cascade"}return"default"}(v.columns,j.value))),V=t((()=>({position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:3,display:"flex",alignItems:"center",justifyContent:"center",color:"var(--z-picker-loading-icon-color)",background:"var(--z-picker-loading-mask-color)"}))),G=t((()=>{const{columns:o}=v;switch(P.value){case"multiple":return o;case"cascade":return function(o,t,e){const n=[];let l={[t.children]:o},a=0;for(;l&&l[t.children];){const o=l[t.children],s=e.value[a];l=_(s)?R(o,s,t):void 0,!l&&o.length&&(l=R(o,q(o)[t.value],t)),a++,n.push(o)}return n}(o,j.value,$);default:return[o]}})),L=t((()=>G.value.some((o=>o.length)))),Y=t((()=>G.value.map(((o,t)=>R(o,$.value[t],j.value))))),J=t((()=>G.value.map(((o,t)=>o.findIndex((o=>o[j.value.value]===$.value[t])))))),oo=t((()=>N.value*+v.visibleOptionNum)),to=t((()=>({height:`${oo.value}px`}))),eo=t((()=>({height:`${N.value}px`}))),no=t((()=>({backgroundSize:`100% ${(oo.value-N.value)/2}px`}))),lo=(o,t)=>{if($.value[o]!==t){const e=$.value.slice(0);e[o]=t,$.value=e}},ao=()=>({selectedValues:$.value.slice(0),selectedOptions:Y.value,selectedIndexes:J.value}),so=()=>{I.forEach((o=>o.stopMomentum()));const o=ao();return w((()=>{h("confirm",o)})),o},io=()=>h("cancel",ao()),co=()=>!1;let uo;g(G,(o=>{o.forEach(((o,t)=>{o.length&&!Q(o,$.value[t],j.value)&&lo(t,q(o)[j.value.value])}))}),{immediate:!0}),g((()=>v.modelValue),(o=>{Z(o,$.value)||Z(o,uo)||($.value=o.slice(0),uo=o.slice(0))}),{deep:!0}),g($,(o=>{Z(o,v.modelValue)||(uo=o.slice(0),h("update:modelValue",uo))}),{immediate:!0});return D({confirm:so,getSelectedOptions:()=>Y.value}),(t,c)=>{const f=d;return e(),n(f,{class:p(m(U)())},{default:l((()=>["top"===v.toolbarPosition?(e(),s(i,{key:0},[v.showToolbar&&!m(B)?(e(),n(W,{key:0,title:v.title,"cancel-button-text":v.cancelButtonText,"confirm-button-text":v.confirmButtonText,"component-slots":H.value?o.componentSlots:m(u).slots,onConfirm:so,onCancel:io},x({_:2},[C("cancel")?{name:"cancel",fn:l((()=>[a(t.$slots,"cancel",{},void 0,!0)])),key:"0"}:void 0,C("confirm")?{name:"confirm",fn:l((()=>[a(t.$slots,"confirm",{},void 0,!0)])),key:"1"}:void 0,C("title")?{name:"title",fn:l((()=>[a(t.$slots,"title",{},void 0,!0)])),key:"2"}:void 0,C("toolbar")?{name:"toolbar",fn:l((()=>[a(t.$slots,"toolbar",{},void 0,!0)])),key:"3"}:void 0]),1032,["title","cancel-button-text","confirm-button-text","component-slots"])):r("",!0)],64)):r("",!0),v.loading?(e(),n(M,{key:1,"wrapper-style":V.value},null,8,["wrapper-style"])):r("",!0),C("columns-top")?a(t.$slots,"columns-top",{key:2},void 0,!0):r("",!0),k(f,{class:p(m(U)("columns")),style:y(to.value),onTouchmove:S(co,["stop","prevent"]),"disable-scroll":"true"},{default:l((()=>[(e(!0),s(i,null,b(G.value,((s,i)=>(e(),n(X,{key:i,value:$.value[i],fields:j.value,options:s,readonly:v.readonly,"allow-html":v.allowHtml,"option-height":N.value,"swipe-duration":v.swipeDuration,"visible-option-num":v.visibleOptionNum,"component-slots":H.value?o.componentSlots:m(u).slots,onChange:o=>((o,t)=>{lo(t,o),"cascade"===P.value&&$.value.forEach(((o,t)=>{const e=G.value[t];Q(e,o,j.value)||lo(t,e.length?e[0][j.value.value]:void 0)})),w((()=>{h("change",z({columnIndex:t},ao()))}))})(o,i),onClickOption:o=>((o,t)=>{const e={columnIndex:t,currentOption:o};h("clickOption",z(ao(),e)),h("scrollInto",e)})(o,i),onScrollInto:o=>{h("scrollInto",{currentOption:o,columnIndex:i})}},x({_:2},[C("option")?{name:"option",fn:l((()=>[a(t.$slots,"option",{},void 0,!0)])),key:"0"}:void 0]),1032,["value","fields","options","readonly","allow-html","option-height","swipe-duration","visible-option-num","component-slots","onChange","onClickOption","onScrollInto"])))),128)),L.value?(e(),s(i,{key:0},[k(f,{class:p(m(U)("mask")),style:y(no.value)},null,8,["class","style"]),k(f,{class:p([m(E),m(U)("frame")]),style:y(eo.value)},null,8,["class","style"])],64)):r("",!0)])),_:3},8,["class","style"]),C("columns-bottom")?a(t.$slots,"columns-bottom",{key:3},void 0,!0):r("",!0),"bottom"===v.toolbarPosition?(e(),s(i,{key:4},[v.showToolbar&&!m(B)?(e(),n(W,{key:0,title:v.title,"cancel-button-text":v.cancelButtonText,"confirm-button-text":v.confirmButtonText,"component-slots":H.value?o.componentSlots:m(u).slots,onConfirm:so,onCancel:io},x({_:2},[C("cancel")?{name:"cancel",fn:l((()=>[a(t.$slots,"cancel",{},void 0,!0)])),key:"0"}:void 0,C("confirm")?{name:"confirm",fn:l((()=>[a(t.$slots,"confirm",{},void 0,!0)])),key:"1"}:void 0,C("title")?{name:"title",fn:l((()=>[a(t.$slots,"title",{},void 0,!0)])),key:"2"}:void 0,C("toolbar")?{name:"toolbar",fn:l((()=>[a(t.$slots,"toolbar",{},void 0,!0)])),key:"3"}:void 0]),1032,["title","cancel-button-text","confirm-button-text","component-slots"])):r("",!0)],64)):r("",!0)])),_:3},8,["class"])}}}),[["__scopeId","data-v-61c64186"]]);export{oo as _,W as z};
