import{d as o,D as e,o as l,c as a,w as t,e as s,F as r,r as i,y as n,n as c,G as u,a as d,p as f,z as p,i as v,L as m,_ as h}from"./index-f30f5313.js";import{n as b,s as z,m as g,t as y,w,i as x,j as C,z as _,y as E,x as H,J as S}from"./DemoPage.cf3c40e0.js";import{u as I}from"./index.3b818c1b.js";import{u as V}from"./use-touch.6469fcb8.js";const k=h(o({name:"ZRate",options:{virtualHost:!0},props:{size:b,icon:z("star-fill"),color:String,count:g(5),gutter:b,clearable:Boolean,readonly:Boolean,disabled:Boolean,voidIcon:z("star"),allowHalf:Boolean,voidColor:String,touchable:y,iconPrefix:String,modelValue:w(0),disabledColor:String},emits:["change","update:modelValue"],setup(o,{emit:h}){const[b,z]=x("rate");C(b);const g=o,y=h,w=m(),k=V(),P=e((()=>g.readonly||g.disabled)),T=e((()=>P.value||!g.touchable)),j=e((()=>Array(+g.count).fill("").map(((o,e)=>function(o,e,l,a){if(o>=e)return{status:"full",value:1};if(o+.5>=e&&l&&!a)return{status:"half",value:.5};if(o+1>=e&&l&&a){const l=10**10;return{status:"half",value:Math.round((o-e+1)*l)/l}}return{status:"void",value:0}}(g.modelValue,e+1,g.allowHalf,g.readonly)))));let M,N,A=Number.MAX_SAFE_INTEGER,B=Number.MIN_SAFE_INTEGER;const R=()=>{Promise.all([H(w,".z-rate-rect"),S(w,".z-rate__item")]).then((([o,e])=>{N=o;M=[],e.forEach(((o,e)=>{A=Math.min(o.top,A),B=Math.max(o.top,B),g.allowHalf?M.push({score:e+.5,left:o.left,top:o.top,height:o.height},{score:e+1,left:o.left+o.width/2,top:o.top,height:o.height}):M.push({score:e+1,left:o.left,top:o.top,height:o.height})}))}))},F=(o,e)=>{for(let l=M.length-1;l>0;l--)if(e>=N.top&&e<=N.bottom){if(o>M[l].left&&e>=M[l].top&&e<=M[l].top+M[l].height)return M[l].score}else{const a=e<N.top?A:B;if(o>M[l].left&&M[l].top===a)return M[l].score}return g.allowHalf?.5:1},G=o=>{P.value||o===g.modelValue||(y("update:modelValue",o),y("change",o))},X=o=>{T.value||(k.start(o),R())},D=o=>{if(!T.value&&(k.move(o),k.isHorizontal()&&!k.isTap.value)){const{clientX:e,clientY:l}=o.touches[0];G(F(e,l))}},Y=o=>{let e={};const l=o+1;return g.gutter&&l!==+g.count&&(e={paddingRight:E(g.gutter)}),e},J=o=>"full"===o.status,L=o=>"void"===o.status,Z=o=>g.allowHalf&&o.value>0&&o.value<1,q=o=>{const e={display:"block",width:"1em",color:"var(--z-rate-icon-void-color)",fontSize:"var(--z-rate-icon-size)"};g.size&&(e["font-size"]=E(g.size));let l={};l=J(o)?{color:"var(--z-rate-icon-full-color)"}:{},g.disabled&&(l.color="var(--z-rate-icon-disabled-color)");let a={};return a=g.disabled&&g.disabledColor?{color:g.disabledColor}:J(o)&&g.color?{color:g.color}:g.voidColor?{color:g.voidColor}:{},{...e,...l,...a}},K=o=>{const e={display:"block",width:o.value+"em",color:"var(--z-rate-icon-void-color)",fontSize:"var(--z-rate-icon-size)"};g.size&&(e["font-size"]=E(g.size));let l={};l=L(o)?{}:{color:"var(--z-rate-icon-full-color)"},g.disabled&&(l.color="var(--z-rate-icon-disabled-color)");let a={};return a=g.disabled&&g.disabledColor?{color:g.disabledColor}:L(o)&&g.voidColor?{color:g.voidColor}:g.color?{color:g.color}:{},{...e,...l,...a}};return I((()=>g.modelValue)),(e,m)=>{const h=v;return l(),a(h,{class:c(["z-rate-rect",u(z)({readonly:g.readonly,disabled:g.disabled})]),onTouchstartPassive:X,onTouchmove:p(D,["stop","prevent"])},{default:t((()=>[(l(!0),s(r,null,i(j.value,((e,s)=>(l(),a(h,{key:s,style:n(Y(s)),class:c(u(z)("item")),onClick:o=>((o,e)=>{const l=o.touches[0],a=e+1;R();let t=g.allowHalf?F(l.clientX,l.clientY):a;g.clearable&&k.isTap.value&&t===g.modelValue&&(t=0),G(t)})(o,s)},{default:t((()=>[d(_,{name:J(e)?o.icon:o.voidIcon,"custom-style":q(e),"class-prefix":o.iconPrefix},null,8,["name","custom-style","class-prefix"]),Z(e)?(l(),a(_,{key:0,"custom-style":K(e),"badge-wrapper-style":{position:"absolute",top:0,left:0,overflow:"hidden",pointerEvents:"none"},name:L(e)?o.voidIcon:o.icon,"class-prefix":o.iconPrefix},null,8,["custom-style","badge-wrapper-style","name","class-prefix"])):f("",!0)])),_:2},1032,["style","class","onClick"])))),128))])),_:1},8,["class"])}}}),[["__scopeId","data-v-e5edf385"]]);export{k as _};
